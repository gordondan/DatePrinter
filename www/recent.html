<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Recent Labels</title>
  <link rel="stylesheet" href="/link-grid.css" />
</head>
<body>

  <script src="/link-grid.js"></script>
  <script>
    async function getRecentItems(){
      const res = await fetch('/api/recent');
      if (!res.ok) return [];
      const data = await res.json();
      // Adapt to link-grid schema
      return (data.items || []).map(it => ({ image_url: it.image_url, path: it.path }));
    }

    async function doReprint(item){
      const res = await fetch('/api/reprint', {
        method: 'POST', headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ path: item.path })
      });
      try {
        const body = await res.json();
        if (res.ok && body.ok) return;
        console.error('Reprint failed', body);
      } catch {}
    }

    async function doDelete(item){
      const res = await fetch('/api/delete', {
        method: 'POST', headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ path: item.path })
      });
      try {
        const body = await res.json();
        return !!(res.ok && body.ok);
      } catch { return false; }
    }

    document.addEventListener('DOMContentLoaded', async () => {
      const mount = document.body; // link-grid creates its own centered wrapper
      const grid = window.createLinkGrid({
        mount,
        getItems: getRecentItems,
        cols: 4,
        rows: 2,
        onEnter: doReprint,
        onDelete: doDelete,
      });
      await grid.load();
    });
  </script>
</body>
</html>
